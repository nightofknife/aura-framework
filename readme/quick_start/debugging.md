
#### **10. 调试技巧 (Debugging)**

# **健壮性与调试：调试技巧**

即使有了强大的错误处理机制，有时任务的行为仍然可能不符合我们的预期。这时，就需要进入“侦探模式”来调试问题。以下是一些能极大提升您调试效率的技巧。

### **1. 善用 `log`，无处不 `log`**

`log` Action 是您在调试工具箱中最重要的工具。不要吝啬使用它！

*   **打印关键变量**: 在执行复杂操作前后，打印出相关的上下文变量，看看它们的值是否符合预期。

    ```yaml
    - name: "从API获取用户数据"
      action: http.request
      params:
        url: "{{ api_endpoint }}/users/{{ user_id }}"
      output_to: "user_data"

    - name: "【调试】检查获取到的数据"
      action: log
      params:
        message: "获取到的用户数据: {{ user_data }}" # 直接打印整个对象
    ```

*   **标记逻辑分支**: 在 `if/then/else` 的不同分支中放置 `log`，以确认您的任务是否走进了正确的逻辑路径。

    ```yaml
    - if: "{{ user_data.is_active }}"
      then:
        - action: log
          params:
            message: "用户是活跃状态，进入处理流程..."
        # ...
      else:
        - action: log
          params:
            message: "用户是非活跃状态，跳过处理。"
        # ...
    ```

### **2. 阅读日志文件**

Aura 的所有输出都会被记录在工作区根目录下的 `logs/` 文件夹中。当任务失败或行为异常时，这里是您寻找线索的第一站。

*   **[INFO]**: 记录了每个步骤的名称、执行情况和 `log` Action 的输出。
*   **[WARNING]**: 记录了非致命性的问题，例如 `retry` 的失败尝试，或 `continue_on_failure` 触发时的信息。
*   **[ERROR]**: 记录了导致任务中断的严重错误，通常会附带详细的异常信息。

学会从上到下阅读日志，找到第一个出现 `[WARNING]` 或 `[ERROR]` 的地方，问题通常就出在那附近。

### **3. 隔离问题：注释与单步模拟**

当一个长任务失败时，问题可能出在任何一步。为了快速定位，您可以像在传统编程中一样，**注释掉**一部分代码来缩小问题范围。

在 YAML 中，注释以 `#` 号开头。

```yaml
- name: "步骤1：登录"
  # ...

# 暂时禁用步骤2和3，看看问题是否还存在
# - name: "步骤2：导航到报表页面"
#   ...
#
# - name: "步骤3：选择日期范围"
#   ...

- name: "步骤4：点击下载按钮"
  # ...
```

通过这种方式，您可以一次只运行任务的一部分，逐步放开注释，直到问题复现。这是一种简单但极其有效的“二分法”调试策略。

### **4. 利用失败截图**

别忘了我们之前提到的失败自动截图功能。当日志告诉你“在步骤‘点击下载按钮’失败”时，立刻去 `debug_screenshots` 文件夹找到对应的截图。

*   按钮是否真的存在？
*   按钮的文本是否和您预期的一样？
*   是不是有一个模态对话框或加载动画覆盖了它？

一张截图往往能提供比几百行日志更直观的信息。


